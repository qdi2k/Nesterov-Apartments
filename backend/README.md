# Nest Apartments - backend
Nest Apartments это backend-решение для организации взаимодействия застройщика с потенциальными 
клиентами. 

---

## Быстрый старт
### Перед стартом - обязательно!

0.  В корне проекта создайте файл `.env` и наполните его в предложенном формате 
    в `example.env`

Выберите предпочитаемый вариант старта.

---
### Старт на localhost - вручную

1. Если у вас нет виртуального окружения, то создайте и активируйте его
```shell
    python -m venv venv
```
```shell
    venv\Scripts\activate.bat
```

2. Обновите pip и установите необходимые зависимости
```shell
    python.exe -m pip install --upgrade pip
```
```shell
    pip install -r requirements.txt
```
3. Примените существующие миграции
```bash 
   alembic upgrade head
```
4. Запустите сервер
```shell
    uvicorn main:app --reload
```

---

### Старт на localhost - Docker:

1. Убедитесь в наличие миграций в директории `app/db/alembic/versions`

2. Соберите образ 
```shell
    docker build -t nest-apartments .
```

3. Запустите контейнер из Docker образа
```shell
    docker run -p 8000:8000 nest-apartments
```

---

## БД и миграции 


Подключение к БД осуществляется в связке `postgresql+asyncpg`

### Для работы с миграциями следует использовать следующие команды:

- Первый анализ изменений в БД и создание миграции

    ###### В репозитории уже есть начальные миграции (можно не использовать).
    ```bash
      alembic revision --autogenerate -m 'initial'
    ```

- Анализ изменений в БД и создание миграции
    ```bash
      alembic revision --autogenerate -m 'migration_name'
    ```

- Применение миграции (Изменение DDL в БД)
    ```bash
      alembic upgrade head
    ```

- Откатить изменения назад
    ```bash
      alembic downgrade -1
    ```

---

## Администраторы админ-панели


Для создания суперпользователя админ-панели, локально или внутри контейнера, используйте следующее:
```bash
    python -m app.admin.createsuperuser --username admin --password admin --email admin@admin.com 
```

###### P.S. данные `username`, `password`, `email` предпочтительнее изменить.

---

## Интеграция с внешним объектным хранилищем

Проект использует облачное объектное хранилище Selectel S3 для хранения и управления 
файлами (например, изображениями квартир). 
Интеграция реализована через стандартный S3 API с использованием следующих параметров:

- **Провайдер**: [Selectel](https://selectel.ru/)
- **Тип хранилища**: *S3-совместимое объектное хранилище*
- **Endpoint URL**: `https://s3.storage.selcloud.ru`
- **Документация**: [Selectel Documentation](https://docs.selectel.ru/)


Для работы с хранилищем необходимо указать переменные окружения в файле .env
(смотреть пример из example.env).

---

## Документация API

**FastAPI** автоматически генерирует интерактивную документацию для вашего 
**API**, это значительно упрощает процесс разработки и взаимодействия с вашим 
приложением. 

Документация доступна по двум стандартным путям:

 - `/api/v1/docs` - Интерактивная документация в формате **Swagger UI**.

 - `/api/v1/redoc` - Альтернативная документация в формате **ReDoc**.

---

## Обратная связь

Если у вас есть вопросы или вам нужна поддержка, свяжитесь со мной 
в телеграмме [@qdi2k](https://t.me/qdi2k)
